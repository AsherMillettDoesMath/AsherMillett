<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Live‚ÄëEditable Site</title>
  <meta name="description" content="A sleek, single‚Äëfile website with built‚Äëin editing tools. Save to your browser and export to GitHub Pages." />
  <style>
    :root{
      --bg:#0b0f14; --panel:#0f1520; --soft:#141a26; --text:#e6eef8; --muted:#b8c2cf; --brand:#6aa2ff; --accent:#a8ffbf;
      --ring:0 0 0 2px rgba(106,162,255,.3);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font:15px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", Arial, "Apple Color Emoji","Segoe UI Emoji"; color:var(--text); background:radial-gradient(1200px 700px at 70% -100px, #132033 0%, transparent 60%), var(--bg);}    

    /* Layout */
    .app{display:grid; grid-template-columns:280px 1fr; min-height:100vh}
    aside{background:linear-gradient(180deg, var(--panel), var(--soft)); border-right:1px solid #1e2a3c; position:relative}
    header.topbar{display:flex; gap:.5rem; align-items:center; padding:12px 16px; position:sticky; top:0; z-index:5; background:linear-gradient(180deg, rgba(11,15,20,.85), rgba(11,15,20,.6)); backdrop-filter:saturate(1.2) blur(6px); border-bottom:1px solid #1e2a3c}
    header .brand{font-weight:700; letter-spacing:.3px}
    header .pill{margin-left:auto; padding:6px 10px; border:1px solid #203049; border-radius:999px; color:var(--muted)}

    /* Sidebar */
    .nav{padding:12px}
    .nav h2{font-size:.9rem; color:var(--muted); margin:8px 10px}
    .tabs{display:flex; flex-direction:column; gap:6px}
    .tab{display:flex; align-items:center; gap:8px; padding:10px 12px; border:1px solid #1e2a3c; border-radius:12px; background:#0d1420; cursor:pointer; user-select:none}
    .tab[aria-selected="true"]{outline:var(--ring); border-color:#2a3b55; background:#0f1b2c}
    .tab .title{flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .tab .move{opacity:.7; font-size:12px}

    .controls{position:sticky; bottom:0; display:grid; gap:8px; padding:12px; background:linear-gradient(180deg, rgba(15,21,32,.2), rgba(15,21,32,.9)); border-top:1px solid #1e2a3c}
    .controls button,.toolbar button{appearance:none; border:1px solid #28405f; background:#0f1726; color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer}
    .controls button:hover,.toolbar button:hover{border-color:#395b8b}
    .controls .row{display:flex; gap:8px}

    /* Main */
    main{position:relative;}
    .toolbar{position:sticky; top:0; display:flex; flex-wrap:wrap; gap:8px; padding:12px; background:linear-gradient(180deg, rgba(11,15,20,.85), rgba(11,15,20,.6)); backdrop-filter:saturate(1.2) blur(6px); border-bottom:1px solid #1e2a3c; z-index:6}
    .toolbar .status{margin-left:auto; color:var(--muted)}

    .canvas{padding:32px; max-width:1000px; margin:0 auto}
    .section{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00)); border:1px solid #203049; border-radius:16px; padding:24px; margin:16px 0}
    .section[contenteditable="true"]{outline:var(--ring)}
    h1,h2,h3{line-height:1.2}
    h1{font-size:2rem; margin:.2rem 0 1rem}
    h2{font-size:1.3rem; margin:1rem 0 .5rem; color:var(--accent)}
    p{color:#d8e1ee}
    a{color:var(--brand); text-decoration:none}
    a:hover{text-decoration:underline}
    img{max-width:100%; height:auto; border-radius:12px; border:1px solid #1f2a3b}
    ul{margin:.5rem 0 .5rem 1.2rem}

    .ghost{opacity:.35}
    .hidden{display:none}
    .small{font-size:.85rem; color:var(--muted)}

    @media (max-width: 900px){
      .app{grid-template-columns:1fr}
      aside{display:none}
    }
  </style>
</head>
<body>
<div class="app" id="app">
  <aside>
    <header class="topbar">
      <div class="brand">‚ú¶ My Site</div>
      <div class="pill small" id="saveState">Unsaved</div>
    </header>
    <div class="nav">
      <h2>Sections</h2>
      <div id="tabs" class="tabs" role="tablist" aria-label="Site Sections"></div>
    </div>
    <div class="controls">
      <div class="row">
        <button id="addSectionBtn">Ôºã Add Section</button>
        <button id="deleteSectionBtn" title="Delete current section">üóëÔ∏è</button>
      </div>
      <div class="row">
        <button id="saveBtn">üíæ Save</button>
        <button id="exportBtn" title="Download this page as a single HTML file">‚¨áÔ∏è Export</button>
      </div>
      <div class="row">
        <button id="importBtn">‚¨ÜÔ∏è Import</button>
        <input id="importFile" type="file" accept="text/html,.html" class="hidden" />
      </div>
    </div>
  </aside>

  <main>
    <div class="toolbar" id="toolbar">
      <button id="toggleEdit">‚úèÔ∏è Edit</button>
      <button data-cmd="bold"><b>B</b></button>
      <button data-cmd="italic"><i>I</i></button>
      <button data-cmd="underline"><u>U</u></button>
      <button id="h2Btn">H2</button>
      <button id="ulBtn">‚Ä¢ List</button>
      <button id="linkBtn">üîó Link</button>
      <button id="imgBtn">üñºÔ∏è Image</button>
      <input id="imgUpload" type="file" accept="image/*" class="hidden" />
      <span class="status small" id="mode">Read‚Äëonly</span>
    </div>

    <div class="canvas" id="canvas">
      <!-- Sections will render here -->
    </div>
  </main>
</div>

<script>
(function(){
  const STORAGE_KEY = 'live_edit_site_v1';
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const state = {
    editing:false,
    sections: [
      { id: crypto.randomUUID(), title: 'Home', html: `<h1>Hi, I\'m <span style="color: var(--brand)">Your Name</span></h1><p>Welcome to my website. Toggle <em>Edit</em> to start customizing. Add sections, links, and images. Your changes save to this browser.</p>` },
      { id: crypto.randomUUID(), title: 'Projects', html: `<h2>Featured Work</h2><ul><li>Project Alpha ‚Äî real‚Äëtime visualization</li><li>Project Beta ‚Äî research notes</li></ul>` },
      { id: crypto.randomUUID(), title: 'About', html: `<h2>About Me</h2><p>Short bio. Interests, skills, and contact.</p>` }
    ],
    activeId: null,
    dirty:false,
  };

  // Load saved content
  function load(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw){
      try{ Object.assign(state, JSON.parse(raw)); }catch(e){ console.warn('Failed to parse saved site:', e); }
    }
    if(!state.activeId && state.sections[0]) state.activeId = state.sections[0].id;
    renderTabs();
    renderSections();
    updateSavePill();
  }

  function save(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify({sections: state.sections, activeId: state.activeId}));
    state.dirty=false; updateSavePill();
  }

  function updateSavePill(){
    const el = $('#saveState');
    el.textContent = state.dirty ? 'Unsaved' : 'Saved';
    el.classList.toggle('ghost', !state.dirty);
  }

  function setDirty(){ state.dirty=true; updateSavePill(); }

  /* Render sidebar tabs */
  function renderTabs(){
    const tabs = $('#tabs');
    tabs.innerHTML = '';
    state.sections.forEach((sec, idx)=>{
      const node = document.createElement('button');
      node.className='tab';
      node.setAttribute('role','tab');
      node.setAttribute('aria-selected', sec.id===state.activeId);
      node.title = 'Drag to reorder';
      node.draggable = true;
      node.dataset.id = sec.id;
      node.innerHTML = `<span class="move">‚â°</span><span class="title" contenteditable="${state.editing}">${sec.title}</span>`;
      node.addEventListener('click', e=>{ state.activeId=sec.id; renderSections(); renderTabs(); });

      // inline rename
      node.querySelector('.title').addEventListener('input', (e)=>{
        sec.title=e.currentTarget.textContent.trim()||'Untitled';
        setDirty();
      });

      // drag & drop reorder
      node.addEventListener('dragstart', (e)=>{ e.dataTransfer.setData('text/plain', sec.id); });
      node.addEventListener('dragover', (e)=> e.preventDefault());
      node.addEventListener('drop', (e)=>{
        e.preventDefault();
        const fromId = e.dataTransfer.getData('text/plain');
        const toId = sec.id;
        if(fromId===toId) return;
        const arr = state.sections;
        const fromIdx = arr.findIndex(s=>s.id===fromId);
        const toIdx   = arr.findIndex(s=>s.id===toId);
        const [moved] = arr.splice(fromIdx,1);
        arr.splice(toIdx,0,moved);
        setDirty();
        renderTabs(); renderSections();
      });
      tabs.appendChild(node);
    });
  }

  /* Render main content */
  function renderSections(){
    const canvas = $('#canvas');
    canvas.innerHTML='';
    const active = state.sections.find(s=>s.id===state.activeId) || state.sections[0];
    if(!active) return;

    const section = document.createElement('section');
    section.className='section';
    section.id = 'section-'+active.id;
    section.contentEditable = String(state.editing);
    section.innerHTML = active.html;

    section.addEventListener('input', ()=>{ active.html = section.innerHTML; setDirty(); });

    canvas.appendChild(section);
    $('#mode').textContent = state.editing ? 'Editing' : 'Read‚Äëonly';
    $$('#tabs .title').forEach(t=> t.setAttribute('contenteditable', String(state.editing)));
  }

  // Toolbar actions
  const toolbar = $('#toolbar');
  toolbar.addEventListener('click', (e)=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    if(btn.id==='toggleEdit'){ state.editing=!state.editing; renderSections(); renderTabs(); return; }
    if(!state.editing) return;

    const cmd = btn.dataset.cmd;
    if(cmd){ document.execCommand(cmd, false, null); setDirty(); return; }
    if(btn.id==='h2Btn'){ document.execCommand('formatBlock', false, 'h2'); setDirty(); return; }
    if(btn.id==='ulBtn'){ document.execCommand('insertUnorderedList'); setDirty(); return; }
    if(btn.id==='linkBtn'){
      const url = prompt('Enter URL (https://...)');
      if(url){ document.execCommand('createLink', false, url); setDirty(); }
      return;
    }
    if(btn.id==='imgBtn'){
      // choose file or paste URL
      const choice = confirm('OK to upload from file. Cancel to insert by URL.');
      if(choice){ $('#imgUpload').click(); }
      else{
        const url = prompt('Image URL (https://...)');
        if(url){ insertImage(url); }
      }
      return;
    }
  });

  $('#imgUpload').addEventListener('change', (e)=>{
    const file = e.target.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = () => insertImage(reader.result);
    reader.readAsDataURL(file);
    e.target.value='';
  });

  function insertImage(src){
    const img = document.createElement('img'); img.src=src; img.alt='';
    const range = getSelection().rangeCount ? getSelection().getRangeAt(0) : null;
    if(range){ range.insertNode(img); }
    else{ $('#canvas .section').appendChild(img); }
    // trigger input capture
    const active = state.sections.find(s=>s.id===state.activeId);
    active.html = $('#canvas .section').innerHTML; setDirty();
  }

  // Sidebar buttons
  $('#addSectionBtn').addEventListener('click', ()=>{
    const id = crypto.randomUUID();
    const title = prompt('New section title','New Section') || 'New Section';
    state.sections.push({id, title, html:`<h2>${escapeHtml(title)}</h2><p>Start writing...</p>`});
    state.activeId = id;
    setDirty(); renderTabs(); renderSections();
  });

  $('#deleteSectionBtn').addEventListener('click', ()=>{
    if(state.sections.length<=1) return alert('At least one section is required.');
    if(!confirm('Delete current section?')) return;
    const idx = state.sections.findIndex(s=>s.id===state.activeId);
    state.sections.splice(idx,1);
    state.activeId = state.sections[Math.max(0, idx-1)].id;
    setDirty(); renderTabs(); renderSections();
  });

  $('#saveBtn').addEventListener('click', save);

  // Export single HTML (self‚Äëcontained)
  $('#exportBtn').addEventListener('click', ()=>{
    const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'index.html';
    a.click();
    URL.revokeObjectURL(a.href);
  });

  // Import (replace from an .html previously exported)
  $('#importBtn').addEventListener('click', ()=> $('#importFile').click());
  $('#importFile').addEventListener('change', (e)=>{
    const file = e.target.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = ()=>{
      const parser = new DOMParser();
      const doc = parser.parseFromString(reader.result, 'text/html');
      try{
        const saved = JSON.parse(doc.querySelector('script[data-snapshot]')?.textContent || '{}');
        if(saved.sections){ state.sections = saved.sections; state.activeId = saved.activeId || saved.sections[0]?.id; save(); load(); }
        else{ throw new Error('No snapshot'); }
      }catch(err){
        // fallback: try to grab sections from DOM
        const importedSections = [...doc.querySelectorAll('.section')].map((el,i)=>({id:crypto.randomUUID(), title: doc.title + ' ' + (i+1), html:el.innerHTML}));
        if(importedSections.length){ state.sections = importedSections; state.activeId = state.sections[0].id; save(); load(); }
        else{ alert('Could not import from this file.'); }
      }
    };
    reader.readAsText(file);
  });

  // Embed a hidden JSON snapshot so exported HTML carries content
  const observer = new MutationObserver(()=>{
    const payload = JSON.stringify({sections: state.sections, activeId: state.activeId});
    let snap = document.querySelector('script[data-snapshot]');
    if(!snap){ snap = document.createElement('script'); snap.type='application/json'; snap.dataset.snapshot='true'; document.body.appendChild(snap); }
    snap.textContent = payload;
  });
  observer.observe(document.body, {subtree:true, childList:true, attributes:true, characterData:true});

  function escapeHtml(s){ return s.replace(/[&<>"] /g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',' ':' '})[c]); }

  // Keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    if((e.metaKey||e.ctrlKey) && e.key.toLowerCase()==='s'){ e.preventDefault(); save(); }
  });

  load();
})();
</script>
</body>
</html>
